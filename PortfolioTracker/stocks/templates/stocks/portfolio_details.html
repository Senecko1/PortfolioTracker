{% extends "base.html" %}
{% load static %}

{% block title %}Portfolio Details{% endblock %}

{% block content %}
    <h2>{{ portfolio.name }} portfolio</h2>

    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    {% if portfolio.description %}
        <h3>Description:</h3>
        <p>{{ portfolio.description }}</p>
    {% endif %}

    <h3>Stocks:</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Stock</th>
                <th>Shares</th>
                <th>Avg. Price</th>
                <th>Current Price</th>
                <th>Current Value</th>
                <th>Gain/Loss</th>
                <th>Gain/Loss %</th>
            </tr>
        </thead>
        <tbody>
            {% for item in holdings_with_prices %}
            <tr>
                <td>{{ item.holding.stock }}</td>
                <td>{{ item.holding.quantity }}</td>
                <td>{{ item.currency }} {{ item.holding.buy_price }}</td>
                <td>
                    {% if item.current_price and item.currency %}
                        {{ item.currency }} {{ item.current_price }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if item.current_value and item.currency %}
                        {{ item.currency }} {{ item.current_value }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td class="{% if item.gain_loss > 0 %}gain-positive{% elif item.gain_loss < 0 %}gain-negative{% else %}gain-neutral{% endif %}">
                    {% if item.gain_loss %}
                        {{ item.currency }} {{ item.gain_loss }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>

                <td class="{% if item.gain_loss_percent > 0 %}gain-positive{% elif item.gain_loss_percent < 0 %}gain-negative{% else %}gain-neutral{% endif %}">
                    {% if item.gain_loss_percent %}
                        {{ item.gain_loss_percent }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>

            </tr>
            {% empty %}
            <tr>
                <td colspan="7">No holdings yet.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h3>Portfolio Summary:</h3>
<table class="table">
    <tr>
        <th>Total Cost</th>
        <td>{{ summary.total_cost }}</td>
    </tr>
    <tr>
        <th>Total Value</th>
        <td>{{ summary.total_value }}</td>
    </tr>
    <tr>
        <th>Gain/Loss</th>
        <td class="{% if summary.gain_loss > 0 %}gain-positive{% elif summary.gain_loss < 0 %}gain-negative{% else %}gain-neutral{% endif %}">
            {{ summary.gain_loss }}
        </td>
    </tr>
    <tr>
        <th>Gain/Loss %</th>
        <td class="{% if summary.gain_loss_percent > 0 %}gain-positive{% elif summary.gain_loss_percent < 0 %}gain-negative{% else %}gain-neutral{% endif %}">
            {{ summary.gain_loss_percent }}%
        </td>
    </tr>
</table>


    <form method="get" action="{% url 'transaction' portfolio.id %}" style="display:inline-block;">
    <button type="submit" class="btn btn-primary">Transaction</button>
</form>


    {% if portfolio %}
        <form method="post" action="{% url 'delete-portfolio' portfolio.id %}" style="display:inline-block">
            {% csrf_token %}
            <button type="submit" onclick="return confirm('Are you sure you want to delete this portfolio?');" class="btn btn-primary">Delete Portfolio</button>
        </form>
    {% endif %}
    <br><br>
    <a href="{% url 'user-portfolios' %}">Back to Portfolios</a>

{% endblock %}
