{% extends "base.html" %}
{% load static %}

{% block title %}Portfolios{% endblock %}

{% block content %}
    <div class="flex justify-between items-start gap-8 flex-wrap">
        <div class="flex-1 min-w-0">
            <h2 class="text-3xl font-semibold mb-6 text-gray-100">
                Welcome, {{ user.username }}
            </h2>
            <p class="mb-6 text-gray-300">
                This is your dashboard. Here you can see your portfolios:
            </p>

            {% if messages %}
                <ul class="mb-6 space-y-2">
                    {% for message in messages %}
                        {% if 'success' in message.tags %}
                            <li class="text-green-500 text-lg font-semibold">
                                {{ message }}
                            </li>
                        {% elif 'warning' in message.tags or 'error' in message.tags %}
                            <li class="text-red-600 text-lg font-semibold">
                                {{ message }}
                            </li>
                        {% else %}
                            <li class="text-indigo-400 text-lg font-semibold">
                                {{ message }}
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% endif %}

            <ol class="list-decimal list-inside space-y-1 text-indigo-300 mb-6 max-w-md">
                {% for portfolio in portfolios %}
                    <li>
                        <a href="{% url 'portfolio-details' portfolio.id %}" class="hover:underline text-indigo-400">
                            {{ portfolio.name }}
                        </a>
                    </li>
                {% empty %}
                    <li class="text-gray-400">You have no portfolios yet.</li>
                {% endfor %}
            </ol>

            <div class="flex space-x-4 mb-6">
                <button type="button"
                    class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-md font-semibold text-white open-modal-btn"
                    data-target="portfolioModal">
                    Create Portfolio
                </button>
                <button type="button"
                    class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-md font-semibold text-white open-modal-btn"
                    data-target="stockModal">
                    Add Stock
                </button>
            </div>

            <div>
                <form method="post" action="{% url 'logout' %}" class="inline">
                    {% csrf_token %}
                    <button type="submit"
                        class="bg-red-600 hover:bg-red-700 text-white font-semibold rounded-md px-4 py-2 mt-4">
                        Log Out
                    </button>
                </form>
            </div>
        </div>

        <div class="flex-shrink-0 ml-8 mr-32 max-w-[45%]">
            <img src="{% static 'images/Invest.jpg' %}" alt="Invest image"
                class="w-full h-full max-w-full rounded shadow-lg object-contain" />
        </div>
    </div>

    <div id="portfolioModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center min-h-screen hidden z-50">
        <div class="bg-gray-800 rounded-lg p-6 relative w-full max-w-md m-auto flex-shrink-0">
            <button type="button" class="absolute top-4 right-4 text-gray-300 hover:text-white text-3xl font-bold modal-close">×</button>
            <h3 class="text-xl font-semibold mb-6 text-white">Create Portfolio</h3>
            <form method="post" action="{% url 'user-portfolios' %}" class="space-y-4">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="{{ portfolio_form.name.id_for_label }}" class="block font-medium mb-1 text-white">
                        {{ portfolio_form.name.label }} <span class="text-red-500">*</span>
                    </label>
                    {{ portfolio_form.name }}
                </div>
                <div class="mb-4">
                    <label for="{{ portfolio_form.description.id_for_label }}" class="block font-medium mb-1 text-white">
                        {{ portfolio_form.description.label }}
                    </label>
                    {{ portfolio_form.description }}
                    {% if portfolio_form.description.help_text %}
                        <span class="text-xs text-gray-500 mt-1">{{ portfolio_form.description.help_text }}</span>
                    {% endif %}
                </div>

                <button type="submit"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white w-full py-2 rounded mt-4">
                    Create
                </button>
            </form>
        </div>
    </div>

    <div id="stockModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center min-h-screen hidden z-50">
        <div class="bg-gray-800 rounded-lg p-6 relative w-full max-w-md m-auto flex-shrink-0">
            <button type="button" class="absolute top-4 right-4 text-gray-300 hover:text-white text-3xl font-bold modal-close">×</button>
            <h3 class="text-xl font-semibold mb-6 text-white">Add Stock</h3>
            <form method="post" action="{% url 'add-stock' %}">
                {% csrf_token %}
                <div class="mb-4">
                    <label for="stock-input" class="block font-medium mb-1">Ticker</label>
                    <input
                        id="stock-input"
                        name="ticker"
                        type="text"
                        class="w-full border border-gray-300 px-2 py-1"
                        autocomplete="off"
                    />
                    <ul id="ticker-suggestions"
                        class="border border-gray-600 mt-1 max-h-40 overflow-auto hidden bg-gray-800 text-gray-100 rounded">
                    </ul>
                </div>
                <div class="mb-4">
                    <label for="tags-input" class="block font-medium mb-1">Tags</label>
                    <input
                        id="tags-input"
                        name="tags"
                        type="text"
                        class="w-full border border-gray-300 px-2 py-1"
                        autocomplete="off"
                    />
                    <ul id="tags-suggestions"
                        class="border border-gray-600 mt-1 max-h-40 overflow-auto hidden bg-gray-800 text-gray-100 rounded">
                    </ul>
                </div>
                <button type="submit"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white w-full py-2 rounded mt-4">
                    Add
                </button>
            </form>
        </div>
    </div>
{% endblock %}
